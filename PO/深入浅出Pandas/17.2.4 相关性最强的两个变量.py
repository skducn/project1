# coding: utf-8
# ********************************************************************************************************************
# Author     : John
# Date       : 2026-1-6
# Description: 17.2.4 相关性最强的两个变量 372页
# https://gairuo.com/p/pandas-book-dataset
# 需求：找出数据框中相关性最强的两个变量
# 相关性计算：corr() 方法计算皮尔逊相关系数
# 矩阵重塑：stack() 将二维相关矩阵转换为一维Series便于排序
# 自相关排除：通过 x<1 条件排除变量与自身的相关性（总是为1）
# 最大值定位：idxmax() 直接获取相关性最强的变量对名称

# 业务意义
# 这种方法可以快速识别数据集中具有强相关性的变量对，有助于：
# 特征选择和降维
# 发现变量间的潜在关系
# 避免多重共线性问题
# ********************************************************************************************************************

import pandas as pd

df = pd.DataFrame({'A':[1,2,4,5,6],'B':[2,4,6,9,10],'C':[2,1,7,2,1]})


print(df.corr()  # 计算数据框中所有列之间的相关系数矩阵
      .stack()  # 将相关系数矩阵转换为Series格式，索引为(列1, 列2)的元组
      .sort_values(ascending=False)  # 按相关系数值降序排列
      .loc[lambda x:x<1]  # 筛选出相关系数小于1的值（排除自己与自己的完全相关）
      .idxmax())  # 获取最大相关系数对应的索引，即相关性最强的变量对

# ('A', 'B')